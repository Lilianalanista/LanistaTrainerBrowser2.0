{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "customerInfoController",
        "designer|userClassName": "CustomerInfoController",
        "id": "customerInfoController"
    },
    "designerId": "9e5b3185-2e11-4b92-ba1e-d80c04f194cd",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainStage",
                "selector": "#mainStage"
            },
            "designerId": "a91a7bac-f86b-490e-b228-69c2d10b95bd"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "leftCommandPanel",
                "selector": "#leftCommandPanel"
            },
            "designerId": "a94b393e-0768-40e3-a7b7-39b6e110f038"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "rightCommandPanel",
                "selector": "#rightCommandPanel"
            },
            "designerId": "ad17d11a-b9b7-4c5a-b68c-01d461d1a9a9"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainViewport",
                "selector": "mainViewport"
            },
            "designerId": "27777be5-f439-4494-81ca-23f6c626d142"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "customerInfoPanel",
                "selector": "#customerInfoPanel",
                "xtype": "customerInfoPanel"
            },
            "designerId": "781a71bc-5792-48c7-8a78-9ea05e66871c"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "customer_personalData",
                "selector": "#customer_personalData"
            },
            "designerId": "fdb954db-b18a-43e4-a449-8dbf0c14eeb8"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "customer_companyContacts",
                "selector": "#customer_companyContacts"
            },
            "designerId": "afa42826-c0aa-437c-84d6-4969e8343d70"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "onShowCustomerInfoPanel",
                "implHandler": [
                    "",
                    "var controller = this;",
                    "var customerInfoPanel\t= controller.getCustomerInfoPanel();",
                    "var mainStage\t= controller.getMainStage();",
                    "",
                    "mainStage.add( customerInfoPanel );",
                    "",
                    "customerInfoPanel.on('hide', function(component) {",
                    "    component.destroy();",
                    "}, controller);",
                    "",
                    "",
                    "// **** 1 create the commands",
                    "LanistaTrainer.app.setStandardButtons('closeCustomerInfoPanelButton');",
                    "",
                    "// *** 2 Show the panel",
                    "customerInfoPanel.loadRecord(LanistaTrainer.app.currentCustomer);",
                    "customerInfoPanel.show();",
                    "",
                    "LanistaTrainer.app.fireEvent('showCustomerInfoHeaderUpdate');",
                    "LanistaTrainer.app.fireEvent('showStage');",
                    "this.showCommands();",
                    "",
                    "// *** 4 Callback",
                    "if (callback instanceof Function) callback();",
                    "",
                    "// *** 5 Load data",
                    "controller.loadData();",
                    "",
                    ""
                ],
                "name": "showCustomerInfoPanel",
                "scope": "this"
            },
            "designerId": "36c47d0f-66dc-4098-81f6-d82fa831df04"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "onCloseCustomerInfoPanel",
                "implHandler": [
                    "var controller = this;",
                    "LanistaTrainer.app.fireEvent('hideStage', function () {",
                    "    controller.getRightCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    controller.getLeftCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    controller.getCustomerInfoPanel().hide();",
                    "    if (callback instanceof Function) callback();",
                    "});"
                ],
                "name": "closeCustomerInfoPanel",
                "scope": "this"
            },
            "designerId": "ee4e7c53-4ac1-4ebe-934a-f380508bdf16"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onShowCustomerInfoHeaderUpdate",
                "implHandler": [
                    "var controller = this,",
                    "    record = LanistaTrainer.app.currentCustomer;",
                    "",
                    "    info = '<div class=\"lansita-header-customer-image-not-found\"><div class=\"lansita-header-customer-photo\" id=\"changeCustomerPhoto\" style=\"background-image: url(' + Ext.ux.ConfigManager.getServer() + Ext.ux.ConfigManager.getRoot() + '/tpmanager/img/p/'+ record.data.id + '_photo.jpg);\"></div></div>';",
                    "",
                    "if (this.getCustomerInfoPanel() && !this.getCustomerInfoPanel().isHidden()) {",
                    "    controller.getMainViewport().down(\"#header\").update({",
                    "       info: info,",
                    "       //title: Ext.ux.LanguageManager.TranslationArray.CUST_MENU_SETUP.toUpperCase()",
                    "       title: ''",
                    "    });",
                    "}"
                ],
                "name": "showCustomerInfoHeaderUpdate",
                "scope": "this"
            },
            "designerId": "93985d27-b803-43ba-830c-93c5f645a1ac"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "showCommands",
                "implHandler": [
                    "",
                    "var controller = this;",
                    "",
                    "controller.getRightCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "",
                    "//Adding bottoms into RightPanel",
                    "",
                    ""
                ]
            },
            "designerId": "2d945cd3-8280-4d99-9d12-f7fa0c757fa7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #showCustomerInfoPanelButton",
                "designer|targetType": "LanistaButton",
                "fn": "onShowCustomerInfoPanelButton",
                "implHandler": [
                    "LanistaTrainer.app.fireEvent('close' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1], function() {",
                    "    LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'UserInfoPanel';",
                    "    LanistaTrainer.app.fireEvent('showCustomerInfoPanel');",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "e21eebb0-5b0c-4b21-8a89-bcfb45f8ebfe"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #closeCustomerInfoPanelButton",
                "designer|targetType": "LanistaButton",
                "fn": "onCloseCustomerInfoPanelButton",
                "implHandler": [
                    "LanistaTrainer.app.panels.splice(LanistaTrainer.app.panels.length - 1, 1);",
                    "LanistaTrainer.app.fireEvent('closeCustomerInfoPanel', function() {",
                    "    LanistaTrainer.app.fireEvent('show' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1]);",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "13a392d0-73fc-4b63-b809-a89c995d46b4"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadData",
                "implHandler": [
                    "var controller = this,",
                    "    fieldset = controller.getCustomer_personalData();",
                    "",
                    "fieldset.setTitle (Ext.ux.LanguageManager.TranslationArray.PERSON_DATA);",
                    "fieldset = controller.getCustomer_companyContacts();",
                    "fieldset.setTitle (Ext.ux.LanguageManager.TranslationArray.ADDRESS);",
                    "",
                    "controller.getCustomerInfoPanel().getForm().findField('customer_email').focus();"
                ]
            },
            "designerId": "847f981c-3427-4c98-9ca0-fb46c314bd6e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callBack"
                ],
                "fn": "loadCurrentUser",
                "implHandler": [
                    "Ext.ux.SessionManager.loadLastUser();",
                    "",
                    "var user = Ext.ux.SessionManager.getUser(),",
                    "    controller = this;",
                    "",
                    "if (user)",
                    "{",
                    "    controller.getUserInfoPanel().getForm().setValues(",
                    "        {",
                    "            email:\t\t\t\t\tuser.email,",
                    "            first_name:\t\t\t\tuser.first_name,",
                    "            last_name:\t\t\t\tuser.last_name,",
                    "            language:\t\t\t\tuser.language,",
                    "            company_name:\t\t\tuser.company_name,",
                    "            phone_nr:\t\t\t\tuser.phone_nr,",
                    "            website:\t\t\t\tuser.website,",
                    "            country:\t\t\t\tuser.country,",
                    "            zipcode:\t\t\t\tuser.zipcode,",
                    "            street:\t\t\t\t\tuser.street,",
                    "            city:\t\t\t\t\tuser.city,",
                    "            user_licenseStatus:\t\t(user.status == 1 ? Ext.ux.LanguageManager.TranslationArray.ACTIVE : Ext.ux.LanguageManager.TranslationArray.INACTIVE),",
                    "            user_licenseValidity:\tuser.expiration_date,",
                    "            id:\t\t\t\t\t\tuser.id",
                    "        }",
                    "    );",
                    "}",
                    "if (callBack instanceof Function) callBack();"
                ]
            },
            "designerId": "d0bd4c8e-ed9a-4b91-94a9-f6f4ade5e489"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #cancelSettingsCustomerButton",
                "designer|targetType": "LanistaButton",
                "fn": "onCancelSettingsButtonClick",
                "implHandler": [
                    "var controller = this;",
                    "",
                    "//controller.loadCurrentUser();",
                    "controller.showCommands();"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "56a6d7eb-fb32-4a6a-a2e5-a8be3121f59c"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #saveSettingsCustomerButton",
                "designer|targetType": "LanistaButton",
                "fn": "onSaveSettingsButtonClick",
                "implHandler": [
                    "var controller = this,",
                    "    server = Ext.ux.ConfigManager.getServer(),",
                    "    root = Ext.ux.ConfigManager.getRoot() + '/tpmanager/',",
                    "    form_data = controller.getCustomerInfoPanel().getValues(),",
                    "    email = form_data.email;",
                    "",
                    "if (email === '')",
                    "{",
                    "        Ext.Msg.alert('Email waren leer', 'Versuche es noch mal !', function() {",
                    "            controller.getCustomerInfoPanel().getForm().findField('email').focus();",
                    "        });",
                    "} else",
                    "{",
                    "    var reg = /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/;",
                    "    if(reg.test(email) === false)",
                    "    {",
                    "        Ext.Msg.alert('Falsche Emailadresse', 'Versuche es noch mal !', function() {",
                    "            controller.getCustomerInfoPanel().getForm().findField('email').focus();",
                    "        });",
                    "    } else",
                    "    {",
                    "        controller.getCustomerInfoPanel().updateRecord();",
                    "        controller.getCustomerInfoPanel().getRecord().setProxy(new Ext.data.proxy.Ajax({",
                    "            url: Ext.ux.ConfigManager.getRoot() + '/tpmanager/user/json',",
                    "            noCache: false,",
                    "            reader: {",
                    "                type: 'json',",
                    "                root: 'entries'",
                    "            },",
                    "            writer: {",
                    "                type: 'json',",
                    "                root: 'records',",
                    "                allowSingle: false",
                    "            },",
                    "            headers: {",
                    "                user_id: localStorage.getItem(\"user_id\")",
                    "            }",
                    "        }));",
                    "",
                    "        controller.getCustomerInfoPanel().getRecord().save({",
                    "            callback: function(record,event,success) {",
                    "                if (success)",
                    "                {",
                    "                    var oldDate = record.data.birthday.split('-'),",
                    "                        newDate;",
                    "                    if (Ext.ux.LanguageManager.lang === 'EN')",
                    "                        newDate = oldDate[1] + oldDate[0] + oldDate[2];",
                    "                    else",
                    "                        newDate = oldDate[0] + oldDate[1] + oldDate[2];",
                    "",
                    "                    record.data.birthday = newDate;",
                    "",
                    "                    controller.getCustomerInfoPanel().loadRecord(record);",
                    "                    Ext.Msg.alert(Ext.ux.LanguageManager.TranslationArray.MSG_DATA_SAVE, Ext.ux.LanguageManager.TranslationArray.MSG_DATA_SAVE, Ext.emptyFn);",
                    "                    controller.showCommands();",
                    "                }",
                    "                else",
                    "                    Ext.Msg.alert(Ext.ux.LanguageManager.TranslationArray.MSG_DATA_NOT_SAVED_1, Ext.ux.LanguageManager.TranslationArray.MSG_DATA_NOT_SAVED_1, Ext.emptyFn);",
                    "            }",
                    "        });",
                    "    }",
                    "}",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "9e7eaf74-bcc7-486a-8919-1a21bc7d398a"
        }
    ]
}