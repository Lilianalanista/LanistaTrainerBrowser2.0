{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "favoritesController",
        "designer|userClassName": "FavoritesController",
        "id": "favoritesController"
    },
    "designerId": "f6908a66-d4db-4a4a-b526-7eac7c5633b7",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainStage",
                "selector": "#mainStage"
            },
            "designerId": "e5fabfaa-21c7-4484-be53-42e0bfcc7aa7"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "rightCommandPanel",
                "selector": "#rightCommandPanel"
            },
            "designerId": "f949e771-6530-4a0a-bdf9-22f183796b3f"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "leftCommandPanel",
                "selector": "#leftCommandPanel"
            },
            "designerId": "d5fb405b-e01b-478d-b378-73524bd84e75"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainViewport",
                "selector": "mainViewport"
            },
            "designerId": "e2b40389-3a32-43bf-beb9-06090118f62d"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "favoritesPanel",
                "selector": "#favoritesPanel",
                "xtype": "favoritesPanel"
            },
            "designerId": "86bdcd3b-1bc7-41b8-9e32-0e919097b0dd"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "title",
                    "message"
                ],
                "fn": "onPromtNewFavorite",
                "implHandler": [
                    "var controller = this;",
                    "Ext.Msg.prompt (title, message, function (response, favoriteName) {",
                    "    if ( response == 'ok' ) {",
                    "        var userId = localStorage.getItem(\"user_id\"),",
                    "            favoriteModel = Ext.create('LanistaTrainer.model.Favorites', {",
                    "                name   : favoriteName,",
                    "                change_date: Date.now(),",
                    "                type: 1,",
                    "                creator_id: userId",
                    "            });",
                    "        favoriteModel.setProxy(new Ext.data.proxy.Ajax({",
                    "            url: Ext.ux.ConfigManager.getRoot() + '/tpmanager/favorites/json',",
                    "            noCache: false,",
                    "            reader: {",
                    "                type: 'json',",
                    "                root: 'entries'",
                    "            },",
                    "            writer: {",
                    "                type: 'json',",
                    "                root: 'records',",
                    "                allowSingle: false",
                    "            },",
                    "            headers: {",
                    "                user_id: userId",
                    "            }",
                    "        }));",
                    "        favoriteModel.save({",
                    "            callback: function(record,event,success) {",
                    "                if (success)",
                    "                {",
                    "                    LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'FavoritesPanel';",
                    "                    LanistaTrainer.app.fireEvent('showFavoritesPanel', record);",
                    "                }",
                    "                else",
                    "                {",
                    "                    Ext.Msg.alert(Ext.ux.LanguageManager.TranslationArray.MSG_DATA_NOT_SAVED_1, Ext.ux.LanguageManager.TranslationArray.MSG_INVITATION_CONFIRMATION_ERROR_1, function () {",
                    "                        LanistaTrainer.app.fireEvent('showCustomersPanel');",
                    "                    });",
                    "                }",
                    "            }",
                    "        });",
                    "    } else",
                    "        LanistaTrainer.app.fireEvent('showCustomersPanel');",
                    "});",
                    "",
                    ""
                ],
                "name": "promtNewFavorite",
                "scope": "this"
            },
            "designerId": "0f3f240e-ac85-44aa-9539-baf9f7b617e0"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "favoriteRecord",
                    "callback"
                ],
                "fn": "onShowFavoritesPanel",
                "implHandler": [
                    "var controller = this,",
                    "    favoritesPanel\t= controller.getFavoritesPanel(),",
                    "    mainStage\t= controller.getMainStage(),",
                    "    storeCustomers = Ext.getStore('CustomerStore'),",
                    "    filterFunction,",
                    "    favoritesIds = [];",
                    "",
                    "mainStage.add( favoritesPanel );",
                    "controller.favorites = favoriteRecord;",
                    "",
                    "filterFunction = new Ext.util.Filter({",
                    "    filterFn: function(item){",
                    "        favoritesIds = favoriteRecord.data.objects ? favoriteRecord.data.objects.split(',') : '';",
                    "        for ( var i = 0; i < favoritesIds.length; i++ ){",
                    "            if (Number(item.data.id) === Number(favoritesIds[i]))",
                    "                return true;",
                    "        }",
                    "    }",
                    "});",
                    "storeCustomers.filters.add(filterFunction);",
                    "storeCustomers.load();",
                    "",
                    "favoritesPanel.on('hide', function(component) {",
                    "    component.destroy();",
                    "}, controller);",
                    "",
                    "// **** 1 create the commands",
                    "LanistaTrainer.app.setStandardButtons('closeFavoritesPanelButton');",
                    "this.showCommands();",
                    "",
                    "// *** 2 Show the panel",
                    "controller.getMainViewport().down(\"#header\").addCls('lanista-header-color-favorites');",
                    "LanistaTrainer.app.fireEvent('showFavoritesHeaderUpdate', favoriteRecord.data.name);",
                    "LanistaTrainer.app.fireEvent('showStage');",
                    "",
                    "// *** 4 Callback",
                    "if (callback instanceof Function) callback();",
                    "",
                    "// *** 5 Load data",
                    "controller.loadData();"
                ],
                "name": "showFavoritesPanel",
                "scope": "this"
            },
            "designerId": "099fd757-b5be-4a55-beab-71cfc55a60a9"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "onCloseFavoritesPanel",
                "implHandler": [
                    "var controller = this;",
                    "LanistaTrainer.app.fireEvent('hideStage', function () {",
                    "    controller.getRightCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    controller.getLeftCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    ",
                    "    controller.getMainViewport().down(\"#header\").removeCls('lanista-header-color-favorites');",
                    "    controller.getFavoritesPanel().hide();",
                    "    if (callback instanceof Function) callback();",
                    "});"
                ],
                "name": "closeFavoritesPanel",
                "scope": "this"
            },
            "designerId": "e98dac40-0923-407b-98a2-ba781688ff44"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "favoriteName"
                ],
                "fn": "onShowFavoritesHeaderUpdate",
                "implHandler": [
                    "var controller = this;",
                    "",
                    "controller.getMainViewport().down(\"#header\").update({",
                    "    info: '',",
                    "    title: Ext.ux.LanguageManager.TranslationArray.BUTTON_FAVORITES.toUpperCase() + ' - ' + favoriteName",
                    "});",
                    "",
                    ""
                ],
                "name": "showFavoritesHeaderUpdate",
                "scope": "this"
            },
            "designerId": "c559cf73-5340-4c38-b6a4-6faa970f83f5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "showCommands",
                "implHandler": [
                    "",
                    "var controller = this;",
                    "",
                    "controller.getRightCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "",
                    "this.getRightCommandPanel().add(",
                    "    Ext.create('LanistaTrainer.view.LanistaButton', {",
                    "        text: Ext.ux.LanguageManager.TranslationArray.FOLDER_CHANGE,",
                    "        itemId: 'showAddCustomersButton',",
                    "        menu: controller.menuFavorites(),",
                    "        menuButtonAlign: 'right',",
                    "        glyph: '108@Lanista Icons' //l",
                    "    })",
                    ");",
                    "",
                    "",
                    "",
                    "",
                    ""
                ]
            },
            "designerId": "f89762e9-f4d3-404a-8498-0deea0ef9b0a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #closeFavoritesPanelButton",
                "designer|targetType": "LanistaButton",
                "fn": "onCloseFavoritesPanelButtonClick",
                "implHandler": [
                    "LanistaTrainer.app.panels.splice(LanistaTrainer.app.panels.length - 1, 1);",
                    "LanistaTrainer.app.fireEvent('closeFavoritesPanel', function() {",
                    "    LanistaTrainer.app.fireEvent('show' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1]);",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "631cad90-3821-4496-aec0-ed7d08cfd847"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadData",
                "implHandler": [
                    ""
                ]
            },
            "designerId": "c7b88aa1-c189-49f7-90ab-d5f4618b24be"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "filterCustomers",
                "implHandler": [
                    "",
                    "",
                    "var filterFunction = new Ext.util.Filter({",
                    "        id: 'machine',",
                    "        filterFn: function(item){",
                    "            if (Ext.isEmpty(this.serchValue)) return true;",
                    "            for (var i = 0; i < item.data.addition.length; i++) {",
                    "                if (item.data.addition[i] ==  this.serchValue)",
                    "                    return true;",
                    "            }",
                    "            return false;",
                    "        }",
                    "    });",
                    "",
                    "    store.filters.insert(2,filterFunction);"
                ]
            },
            "designerId": "28fbf329-7924-4f72-ab07-7990e694c4c0"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "menuFavorites",
                "implHandler": [
                    "var menu = new Ext.menu.Menu(",
                    "    {",
                    "        Itemid:'favoritesMenu',",
                    "        defaults: {",
                    "            height: '50px',",
                    "            width: '220px'",
                    "        },",
                    "        items:",
                    "        [",
                    "            {text: '<span class=\"lanista-icon\">l&nbsp</span>' + Ext.ux.LanguageManager.TranslationArray.BUTTON_ADD_TO_FAVORITE.toUpperCase(),",
                    "             handler: function () {",
                    "                 LanistaTrainer.app.fireEvent('close' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1], function() {",
                    "                     LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'CustomersPanel';",
                    "                     LanistaTrainer.app.fireEvent('showCustomersPanel', this.favorites);",
                    "                 });",
                    "             }",
                    "            },",
                    "            {text: '<span class=\"lanista-icon\">I&nbsp</span>' + Ext.ux.LanguageManager.TranslationArray.FOLDER_CHANGE_NAME.toUpperCase(),",
                    "             handler: function () {",
                    "",
                    "             }",
                    "            },",
                    "            {text: '<span class=\"lanista-icon\">u&nbsp</span>' + Ext.ux.LanguageManager.TranslationArray.FOLDER_REMOVE.toUpperCase(),",
                    "             handler: function () {",
                    "",
                    "             }",
                    "            }",
                    "        ]",
                    "    }",
                    ");",
                    "",
                    "return menu;"
                ]
            },
            "designerId": "adcdc484-1534-4a57-a966-80e805e27b9d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "saveFavorite",
                "implHandler": [
                    "var controller = this,",
                    "    userId = localStorage.getItem(\"user_id\"),",
                    "    favoritesModel;",
                    "",
                    "favoritesModel = Ext.create('LanistaTrainer.model.Favorites');",
                    "controller.favorites.data.change_date = Date.now();",
                    "favoritesModel.data = controller.favorites.data;",
                    "",
                    "favoritesModel.setProxy(new Ext.data.proxy.Ajax({",
                    "    url: Ext.ux.ConfigManager.getRoot() + '/tpmanager/favorites/json',",
                    "    model: 'Favorites',",
                    "    noCache: false,",
                    "    reader: {",
                    "        type: 'json',",
                    "        root: 'entries'",
                    "    },",
                    "    writer: {",
                    "        type: 'json',",
                    "        root: 'records',",
                    "        allowSingle: false",
                    "    },",
                    "    headers: {",
                    "        user_id: userId",
                    "    }",
                    "}));",
                    "",
                    "favoritesModel.save ({",
                    "    callback: function( item, operation, success ) {",
                    "        if (callback instanceof Function) callback();",
                    "    }",
                    "});",
                    "",
                    "",
                    "",
                    ""
                ]
            },
            "designerId": "2e8d90a4-c82c-4448-8746-fdea16133f59"
        }
    ]
}