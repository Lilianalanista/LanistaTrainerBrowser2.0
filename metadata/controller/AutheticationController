{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "autheticationController",
        "designer|userClassName": "AutheticationController"
    },
    "designerId": "508219c0-9471-4ec3-8aa1-a7a9402632fb",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #loginButton",
                "designer|targetType": "LanistaButton",
                "fn": "onLoginButtonClick",
                "implHandler": [
                    "var self = this,",
                    "    thereAreCook = true,",
                    "    cookie,",
                    "    i = 1;",
                    "",
                    "LanistaTrainer.app.fireEvent('hideStage', function () {",
                    "",
                    "    var form = self.getLoginPanel(),",
                    "        form_data = form.getValues(),",
                    "        email = form_data.user_email,",
                    "        password = form_data.password,",
                    "        controller = controller;",
                    "",
                    "    if (email === '' || password === '') {",
                    "        //Ext.Msg.alert('Email oder Passwort waren leer', 'Versuche es noch mal !', function() {",
                    "        Ext.Msg.alert(Ext.ux.LanguageManager.TranslationArray.MSG_EMPTY_TEXT, Ext.ux.LanguageManager.TranslationArray.MSG_TRY_AGAIN, function() {",
                    "            LanistaTrainer.app.fireEvent('showStage');",
                    "            LanistaTrainer.app.fireEvent('setFieldsFocus', true, 'user_email');",
                    "        });",
                    "    } else {",
                    "        var reg = /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/;",
                    "        if(reg.test(email) === false) {",
                    "            //Ext.Msg.alert('Falsche Emailadresse', Ext.ux.LanguageManager.TranslationArray.MSG_TRY_AGAIN, function() {",
                    "            Ext.Msg.alert(Ext.ux.LanguageManager.TranslationArray.MSG_EMAIL_INVALID_1, Ext.ux.LanguageManager.TranslationArray.MSG_TRY_AGAIN, function() {",
                    "                LanistaTrainer.app.fireEvent('showStage');",
                    "                LanistaTrainer.app.fireEvent('setFieldsFocus', true, \"user_email\");",
                    "            });",
                    "        } else {",
                    "            LanistaTrainer.app.fireEvent('loginUser', email, password, function (data) {",
                    "                LanistaTrainer.app.getController('LoginController').getMainViewport().down(\"#header\").el.dom.children[0].innerHTML = '';",
                    "                Ext.ux.SessionManager.loadLastUser();",
                    "",
                    "                //Setting new Cookie",
                    "                while (thereAreCook){",
                    "                    cookie = Ext.util.Cookies.get('userLanista' + i);",
                    "                    if (cookie){",
                    "                        if (cookie.trim() === email.trim())",
                    "                            thereAreCook = false;",
                    "                    }",
                    "                    else{",
                    "                        Ext.util.Cookies.set(\"userLanista\" + (i), email);",
                    "                        thereAreCook = false;",
                    "                    }",
                    "                    i = i + 1;",
                    "                }",
                    "",
                    "                var user = Ext.ux.SessionManager.getUser(),",
                    "                    //url = 'ext/locale/ext-lang-' + user.language.toLowerCase() + '.js';",
                    "                    url = 'lib/ext-locale/ext-locale-' + user.language.toLowerCase() + '.js';",
                    "",
                    "                if (user.language != Ext.ux.LanguageManager.lang)",
                    "                    LanistaTrainer.app.fireEvent('changeLanguage', user.language, false);",
                    "",
                    "                Ext.Ajax.request({",
                    "                    url: url,",
                    "                    success: function(response) {",
                    "                        eval(response.responseText);",
                    "                        console.log(\"Language was changed\");",
                    "                    },",
                    "                    failure: function(response) {",
                    "                        console.log(\"Language couldn't be changed\");",
                    "                    },",
                    "                    scope: this",
                    "                });",
                    "",
                    "                LanistaTrainer.app.setProxies();",
                    "",
                    "                if (user.role === '2' )  //Only Role 2 means that it is a Trainer",
                    "                    LanistaTrainer.app.fireEvent('showDashboardPanel');",
                    "                else{  //It is a  Kunden",
                    "                    Ext.Ajax.request({",
                    "                        url: Ext.ux.ConfigManager.getRoot() +'/tpmanager/user/getuser',",
                    "                        method: 'get',",
                    "                        params: {id: user.id},",
                    "                        headers: {user_id: user.id},",
                    "                        failure : function(result, request){",
                    "                            console.log( \"There were problems in looking for user information, Err number: \" + result.status);",
                    "                            if (result.status === 401 || result.status === 403)",
                    "                                LanistaTrainer.app.fireEvent('reconect');",
                    "                        },",
                    "                        success: function(response, opts) {",
                    "                            try {",
                    "                                data = Ext.decode(response.responseText);",
                    "                                ActiveCustomer = Ext.create('LanistaTrainer.model.Customer', {",
                    "                                    id: data.user.id,",
                    "                                    first_name: data.user.first_name,",
                    "                                    last_name: data.user.last_name,",
                    "                                    email: data.user.email,",
                    "                                    street: data.user.street,",
                    "                                    city: data.user.city,",
                    "                                    zipcode: data.user.zipcode,",
                    "                                    country: data.user.country,",
                    "                                    note: data.user.note,",
                    "                                    phone_nr: data.user.phone_nr,",
                    "                                    birthday: data.user.birthday,",
                    "                                    gender: data.user.gender,",
                    "                                    deleted: data.user.deleted,",
                    "                                    image: data.user.image,",
                    "                                    last_change: data.user.last_change,",
                    "                                    language: data.user.language,",
                    "                                    sincronized: data.user.sincronized",
                    "                                });",
                    "",
                    "                                LanistaTrainer.app.fireEvent('close' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1], function() {",
                    "                                    LanistaTrainer.app.currentCustomer = ActiveCustomer;",
                    "                                    LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'CustomerExercisesPanel';",
                    "                                    LanistaTrainer.app.fireEvent('showCustomerExercisesPanel');",
                    "                                });",
                    "                            }",
                    "                            catch( err ) {",
                    "                                Ext.Msg.alert('Problem', 'There were problems in looking for user information', Ext.emptyFn);",
                    "                            }",
                    "                        }",
                    "                    });",
                    "                }",
                    "",
                    "            }, //End for success function",
                    "                                         function (status) {",
                    "                                             console.log(\"MARK 2\");",
                    "                                             console.log(status);",
                    "                                             if (status == 3){",
                    "                                                 Ext.Msg.alert('Anmeldungsfehler', 'Konto inaktiv. Bitte bestätige die Aktivierungsmail', function() {",
                    "                                                     LanistaTrainer.app.fireEvent('showStage');",
                    "                                                     LanistaTrainer.app.fireEvent('setFieldsFocus', false, \"\");",
                    "                                                 });",
                    "                                             }else if (status == 2){",
                    "                                                 Ext.Msg.alert('Anmeldungsfehler', 'Email oder password waren inkorrekt', function() {",
                    "                                                     LanistaTrainer.app.fireEvent('showStage');",
                    "                                                     LanistaTrainer.app.fireEvent('setFieldsFocus', false, \"\");",
                    "                                                 });",
                    "                                             } else if (status == 100){",
                    "                                                 Ext.Msg.alert('Login fehlgeschlagen', 'Trainings-App ist nur für Sportler', function() {",
                    "                                                     LanistaTrainer.app.fireEvent('showStage');",
                    "                                                     LanistaTrainer.app.fireEvent('setFieldsFocus', false, \"\");",
                    "                                                 });",
                    "                                             } else {",
                    "                                                 Ext.Msg.alert('Verbindungsfehler', 'Versuche es noch mal !', function() {",
                    "                                                     LanistaTrainer.app.fireEvent('showStage');",
                    "                                                     LanistaTrainer.app.fireEvent('setFieldsFocus', false, \"\");",
                    "                                                 });",
                    "                                             }",
                    "",
                    "                                         });",
                    "        }",
                    "    }",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLoginButtonClick",
            "designerId": "6038646c-653a-4e27-ba40-7a37ea024b87"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #logoutButton",
                "designer|targetType": "LanistaButton",
                "fn": "onLogoutButtonClick",
                "implHandler": [
                    "var user = Ext.ux.SessionManager.getUser(),",
                    "    event,",
                    "    customer = LanistaTrainer.app.currentCustomer;",
                    "",
                    "event = user.role === '2' ? 'closeUserInfoPanel' : 'closeCustomerInfoPanel';",
                    "",
                    "LanistaTrainer.app.fireEvent('hideStage', function () {",
                    "    LanistaTrainer.app.fireEvent('logoutUser', function () {",
                    "       LanistaTrainer.app.fireEvent(event, function() {",
                    "            localStorage.removeItem(\"user_id\");",
                    "            localStorage.removeItem(\"user_name\");",
                    "            localStorage.removeItem(\"password\");",
                    "            localStorage.removeItem(\"email\");",
                    "            localStorage.removeItem(\"language\");",
                    "            localStorage.removeItem(\"first_name\");",
                    "            localStorage.removeItem(\"last_name\");",
                    "            localStorage.removeItem(\"birthday\");",
                    "            localStorage.removeItem(\"gender\");",
                    "            localStorage.removeItem(\"status\");",
                    "            localStorage.removeItem(\"expiration_date\");",
                    "            localStorage.removeItem(\"bu\");",
                    "            localStorage.removeItem(\"role\");",
                    "            localStorage.removeItem(\"version\");",
                    "            localStorage.removeItem(\"country\");",
                    "            localStorage.removeItem(\"zipcode\");",
                    "            localStorage.removeItem(\"city\");",
                    "            localStorage.removeItem(\"street\");",
                    "            localStorage.removeItem(\"company_name\");",
                    "            localStorage.removeItem(\"phone_nr\");",
                    "            localStorage.removeItem(\"recognition\");",
                    "            localStorage.removeItem(\"privacy\");",
                    "            localStorage.removeItem(\"website\");",
                    "",
                    "            var len = LanistaTrainer.app.panels.length;",
                    "            for(var i = 0; i < len; i++) {",
                    "                LanistaTrainer.app.panels.splice(LanistaTrainer.app.panels.length - 1, 1);",
                    "            }",
                    "           ",
                    "           if (customer)",
                    "               LanistaTrainer.app.currentCustomer = null;",
                    "",
                    "            LanistaTrainer.app.fireEvent('showLoginPanel');",
                    "       });",
                    "    });",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLogoutButtonClick",
            "designerId": "808a12fa-bcba-4e0f-9465-1c68b859d0c1"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "email",
                    "password",
                    "successCallback",
                    "errorCallback"
                ],
                "fn": "onLoginUser",
                "implHandler": [
                    "Ext.ux.SessionManager.login (email, password, function(success, data) {",
                    "    if (success) {",
                    "        if (successCallback && successCallback instanceof Function) {",
                    "            successCallback(data);",
                    "        }",
                    "    } else {",
                    "        if (errorCallback && errorCallback instanceof Function) {",
                    "            errorCallback(data);",
                    "        }",
                    "    }",
                    "});"
                ],
                "name": "loginUser",
                "scope": "this"
            },
            "name": "onLoginUser",
            "designerId": "77a295bd-ba54-48c4-a693-d995ce8a716c"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "CallBack"
                ],
                "fn": "onLogoutUser",
                "implHandler": [
                    "Ext.ux.SessionManager.logout ( function() {",
                    "    if (CallBack && CallBack instanceof Function) {",
                    "        CallBack();",
                    "    }",
                    "});"
                ],
                "name": "logoutUser",
                "scope": "this"
            },
            "name": "onLogoutUser",
            "designerId": "8973cf80-9eb4-443f-a386-df1a54c577a5"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "loginPanel",
                "selector": "loginPanel",
                "xtype": "loginPanel"
            },
            "name": "loginPanel",
            "designerId": "194c27df-71e9-4622-ab1c-23ad60d078c3"
        }
    ]
}