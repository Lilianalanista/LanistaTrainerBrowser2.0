{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "exerciseController",
        "designer|userClassName": "ExerciseController",
        "id": "ExerciseController"
    },
    "designerId": "5276ac9b-8d40-4de3-b7e5-775fb50be203",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainStage",
                "selector": "#mainStage"
            },
            "designerId": "11515390-f4bd-4560-968c-88a0c48a9541"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "rightCommandPanel",
                "selector": "#rightCommandPanel"
            },
            "designerId": "d165ea93-537e-459c-a5e1-5f867d61bc9e"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "leftCommandPanel",
                "selector": "#leftCommandPanel"
            },
            "designerId": "26c5c282-c226-4946-9ebd-ce9bee93e67d"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainViewport",
                "selector": "mainViewport"
            },
            "designerId": "7e31afd4-0ae4-4378-b79f-d22e24e3e49c"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "exercisePanel",
                "selector": "#exercisePanel",
                "xtype": "exercisePanel"
            },
            "designerId": "3766444b-ab43-4b2b-93e1-f9fb47bf0d8d"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record",
                    "protocolls",
                    "callback"
                ],
                "fn": "onShowExercisePanel",
                "implHandler": [
                    "var controller = this,",
                    "    exercisePanel\t= controller.getExercisePanel(),",
                    "    mainStage\t= controller.getMainStage();",
                    "",
                    "controller.record = record;",
                    "exercisePanel.down('#exercisePanelHeader').data = record.data;",
                    "exercisePanel.down('#exercisePanelContent').items.items[0].data = record.data;",
                    "",
                    "//var currentPlan = LanistaTrainer.app.getController ( 'PlanController' ).plan;",
                    "//if ( currentPlan ) {",
                    "    //console.log ( controller.currentPlanExercise );",
                    "    //controller.currentPlanExercise.set ( \"training\", controller.currentPlanExercise.get ( \"training_min\" ));",
                    "    //controller.currentPlanExercise.set ( \"weight\", controller.currentPlanExercise.get ( \"weight_min\" ));",
                    "    //exercisePanel.down('#exercisePanelContent').getTabBar().getAt (3).show();",
                    "    //exercisePanel.down('#configurationPanel').setRecord ( controller.currentPlanExercise );",
                    "//}",
                    "",
                    "if ( LanistaTrainer.app.currentCustomer ) {",
                    "    exercisePanel.down('#exercisePanelContent').setActiveTab(0).show();",
                    "",
                    "",
                    "    // get user protocolls",
                    " /*   var protocollsStore = Ext.getStore( \"ProtocollStore\" );",
                    "    protocollsStore.clearGrouping();",
                    "    protocollsStore.clearFilter();",
                    "    if ( record.data.ext_id.indexOf ( 'CUST' ) == -1 )",
                    "        protocollsStore.filter ( 'exercise_id', record.data.id );",
                    "    else",
                    "        protocollsStore.filter ( 'user_exercise_id', record.data.id );",
                    "    protocollsStore.load (function (records) {",
                    " */",
                    "",
                    "",
                    "        console.log (\"OPENING RECORD...\");",
                    "        console.log ( protocolls.data.items[0] );",
                    "        exercisePanel.down('#exerciseProtocolls').store = protocolls;",
                    "        if ( protocolls.data.items.length > 0 ) {",
                    "            exercisePanel.down('#protocollPanel').data = protocolls.data.items[0];",
                    "            exercisePanel.down('#protocollsTabPanel')    ",
                    "        } else {",
                    "            // USE THE EXERCISE CONFIGURATION",
                    "            console.log ( \"USING EXERCISE CONFIGURATION\");",
                    "            //console.log ( controller.currentPlanExercise );",
                    "            //exercisePanel.down('#protocollPanel').setRecord ( controller.currentPlanExercise );",
                    "        }",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "   // });",
                    "}",
                    "",
                    "Ext.getCmp('mainViewport').add( exercisePanel );",
                    "",
                    "exercisePanel.on('hide', function(component) {",
                    "    component.destroy();",
                    "}, controller);",
                    "",
                    "// **** 1 create the commands",
                    "LanistaTrainer.app.setStandardButtons('closeExercisePanelButton');",
                    "this.showCommands();",
                    "",
                    "// *** 2 Show the panel",
                    "exercisePanel.show();",
                    "",
                    "LanistaTrainer.app.fireEvent('showExerciseHeaderUpdate');",
                    "LanistaTrainer.app.fireEvent('showStage');",
                    "",
                    "// *** 4 Callback",
                    "if (callback instanceof Function) callback();",
                    "",
                    "// *** 5 Load data",
                    "controller.loadData();"
                ],
                "name": "showExercisePanel",
                "scope": "this"
            },
            "designerId": "b7e11416-822c-48c9-9af2-6e16a3113f7b"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "onCloseExercisePanel",
                "implHandler": [
                    "var controller = this;",
                    "",
                    "controller.getRightCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "controller.getLeftCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "controller.getExercisePanel().hide();",
                    "if (callback instanceof Function) callback();",
                    ""
                ],
                "name": "closeExercisePanel",
                "scope": "this"
            },
            "designerId": "7e059891-b0d1-42f2-94d5-77be9f459db6"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onShowExerciseHeaderUpdate",
                "implHandler": [
                    "",
                    "var controller = this,",
                    "    user = Ext.ux.SessionManager.getUser(),",
                    "    divLogo = '<div class=\"lansita-header-customer-image-not-found show-info-customer\" id=\"showPersonalDataButton\"><div class=\"lansita-header-customer-logo show-info-customer\" id=\"showPersonalDataButton\" style=\"background-image: url(' + Ext.ux.ConfigManager.getServer() + Ext.ux.ConfigManager.getRoot() + '/tpmanager/img/p/'+ localStorage.getItem( \"user_id\" ) + '_photo.jpg);\"></div></div>';",
                    "    divInfoCustomer = '<div class=\"lansita-header-customer-name\"> <span class=\"last-name\">' + user.last_name + '</span><br> <span class=\"first-name\">' + user.first_name +'</span></div>';",
                    "",
                    "controller.getMainViewport().down(\"#header\").update({",
                    "    info: divLogo + divInfoCustomer,",
                    "    title: '-' + Ext.ux.LanguageManager.TranslationArray.EXERCISE.toUpperCase()",
                    "});",
                    "",
                    ""
                ],
                "name": "showExerciseHeaderUpdate",
                "scope": "this"
            },
            "designerId": "cdabd1c1-d1c0-4431-95d3-fc3c1eb85b61"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "showCommands",
                "implHandler": [
                    "",
                    "var controller = this;",
                    "",
                    "controller.getRightCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "",
                    "",
                    "",
                    "",
                    ""
                ]
            },
            "designerId": "fd6c9d72-16de-45e3-a9d9-7a588fddf3f8"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadData",
                "implHandler": [
                    ""
                ]
            },
            "designerId": "4def836f-6d06-4af9-a71d-d885c66f98d2"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "viewport #closeExercisePanelButton",
                "designer|targetType": "LanistaButton",
                "fn": "onCloseExercisePanelButtonClick",
                "implHandler": [
                    "var controller = this;",
                    "",
                    "LanistaTrainer.app.fireEvent('closeExercisePanel'  , function() {",
                    "    controller.getMainStage().getLayout().getActiveItem().removeCls ('blured');",
                    "    controller.getMainStage().getLayout().getActiveItem().controller.showCommands();",
                    "    console.log ( controller.getMainStage().getLayout().getActiveItem().controller );",
                    "    //controller.getMainStage().getActiveItem().controller.setHeader ();",
                    "});",
                    "",
                    "",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "a63a4abb-23ad-4785-ba69-7f020d28f70c"
        }
    ]
}