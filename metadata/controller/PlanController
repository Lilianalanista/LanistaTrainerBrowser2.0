{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "planController",
        "designer|userClassName": "PlanController",
        "id": "PlanController"
    },
    "designerId": "3cebb1f9-1e3f-4ce1-a430-d2db18adcf91",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainStage",
                "selector": "#mainStage"
            },
            "designerId": "8b37e158-2337-4267-b002-8cba77818e63"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "rightCommandPanel",
                "selector": "#rightCommandPanel"
            },
            "designerId": "a37712e7-d056-4d73-8ec7-2a9fff12675d"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "leftCommandPanel",
                "selector": "#leftCommandPanel"
            },
            "designerId": "2d90f5a6-a52b-448f-9912-37fe80dfbeba"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainViewport",
                "selector": "mainViewport"
            },
            "designerId": "0c02d580-9306-41f1-8a3d-385438c461c3"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "planPanel",
                "selector": "#planPanel",
                "xtype": "planPanel"
            },
            "designerId": "083c8fad-bfb1-4f3e-bc8e-673e562572dc"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "autoCreate": true,
                "ref": "planEditPanel",
                "selector": "#planEditPanel",
                "xtype": "planEditPanel"
            },
            "designerId": "eb64cc1c-5404-45b6-ad78-2fff325a352c"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "onClosePlanPanel",
                "implHandler": [
                    "var controller = this;",
                    "LanistaTrainer.app.fireEvent('hideStage', function () {",
                    "    controller.getRightCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    controller.getLeftCommandPanel().items.each(function (item) {",
                    "        item.hide();",
                    "    });",
                    "    controller.getPlanPanel().hide();",
                    "    if (callback instanceof Function) callback();",
                    "});"
                ],
                "name": "closePlanPanel",
                "scope": "this"
            },
            "designerId": "7492bbfd-0def-48f0-a5bd-db7e812eda7c"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "backAction",
                    "callback"
                ],
                "fn": "onShowPlanPanel",
                "implHandler": [
                    "var controller = this,",
                    "    planPanel\t= controller.getPlanPanel(),",
                    "    mainStage\t= controller.getMainStage();",
                    "",
                    "mainStage.add( planPanel );",
                    "",
                    "planPanel.on('hide', function(component) {",
                    "    component.destroy();",
                    "}, controller);",
                    "",
                    "// **** 1 create the commands",
                    "LanistaTrainer.app.setStandardButtons();",
                    "this.showCommands();",
                    "",
                    "// *** 2 Show the panel",
                    "LanistaTrainer.app.fireEvent('showStage');",
                    "",
                    "// *** 4 Callback",
                    "if (callback instanceof Function) callback();",
                    "",
                    "// *** 5 Load data",
                    "controller.loadData();"
                ],
                "name": "showPlanPanel",
                "scope": "this"
            },
            "designerId": "b9fd5ec6-f156-4497-a8e3-81997946d79f"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onShowPlanHeaderUpdate",
                "implHandler": [
                    "",
                    "var controller = this,",
                    "    user = Ext.ux.SessionManager.getUser(),",
                    "    divLogo = '<div class=\"lansita-header-customer-image-not-found show-info-customer\" id=\"showPersonalDataButton\"><div class=\"lansita-header-customer-logo show-info-customer\" id=\"showPersonalDataButton\" style=\"background-image: url(' + Ext.ux.ConfigManager.getServer() + Ext.ux.ConfigManager.getRoot() + '/tpmanager/img/p/'+ localStorage.getItem( \"user_id\" ) + '_photo.jpg);\"></div></div>';",
                    "    divInfoCustomer = '<div class=\"lansita-header-customer-name\"> <span class=\"last-name\">' + user.last_name + '</span><br> <span class=\"first-name\">' + user.first_name +'</span></div>';",
                    "",
                    "controller.getMainViewport().down(\"#header\").update({",
                    "    info: divLogo + divInfoCustomer,",
                    "    title: '-' + Ext.ux.LanguageManager.TranslationArray.DASHBOARD.toUpperCase()",
                    "});",
                    "",
                    ""
                ],
                "name": "showPlanHeaderUpdate",
                "scope": "this"
            },
            "designerId": "a4e3ea5e-37d9-455d-a8af-afdd412f7fb0"
        },
        {
            "type": "applicationaction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "planname"
                ],
                "fn": "onCreatePlan",
                "implHandler": [
                    "var userId = localStorage.getItem(\"user_id\"),",
                    "    newPlan = Ext.create('LanistaTrainer.model.Plan', {",
                    "        name : ( planname && planname.length > 1 )? planname : Ext.ux.LanguageManager.TranslationArray.PLAN_NAME_DEFAULT,",
                    "        template: 0,",
                    "        customer_id: LanistaTrainer.app.currentCustomer.data.id",
                    "    });",
                    "",
                    "newPlan.setProxy(new Ext.data.proxy.Ajax({",
                    "    url: Ext.ux.ConfigManager.getRoot() + '/tpmanager/plan/json',",
                    "    model: 'Protocoll',",
                    "    noCache: false,",
                    "    reader: {",
                    "        type: 'json',",
                    "        root: 'entries'",
                    "    },",
                    "    writer: {",
                    "        type: 'json',",
                    "        root: 'records'",
                    "    },",
                    "    headers: {",
                    "        user_id: userId",
                    "    }",
                    "}));",
                    "",
                    "newPlan.save (",
                    "    {",
                    "        callback: function ( record ){",
                    "            LanistaTrainer.app.getController ( 'PlanController' ).plan = record;",
                    "            LanistaTrainer.app.fireEvent( 'showPlanPanel', 'showCustomerExercisesPanel' );",
                    "        }",
                    "    });",
                    "",
                    ""
                ],
                "name": "createPlan",
                "scope": "this"
            },
            "designerId": "c1cedf52-c996-42d9-a48c-60a61796a926"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "callback"
                ],
                "fn": "showCommands",
                "implHandler": [
                    "",
                    "var controller = this;",
                    "",
                    "controller.getRightCommandPanel().items.each(function (item) {",
                    "    item.hide();",
                    "});",
                    "",
                    "this.getRightCommandPanel().add(",
                    "    Ext.create('LanistaTrainer.view.LanistaButton', {",
                    "        text: Ext.ux.LanguageManager.TranslationArray.BUTTON_ADD_EXERCISES,",
                    "        itemId: 'showAddExerciseButton',",
                    "        userAlias: 'customerButton',",
                    "        glyph: '108@Lanista Icons' //l",
                    "    })",
                    ");",
                    "",
                    "this.getRightCommandPanel().add(",
                    "    Ext.create('LanistaTrainer.view.LanistaButton', {",
                    "        text: Ext.ux.LanguageManager.TranslationArray.BUTTON_PLAN_OPTIONS,",
                    "        itemId: 'showPlanOptionsButton',",
                    "        style: 'float: left;',",
                    "        glyph: '120@Lanista Icons' //x",
                    "    })",
                    ");",
                    "",
                    "",
                    "",
                    ""
                ]
            },
            "designerId": "1d82cff0-19ac-4c98-be3b-f6eaadb80802"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadData",
                "implHandler": [
                    ""
                ]
            },
            "designerId": "b3691cac-ccdb-4fbd-8c98-0fd0fb5bb158"
        }
    ]
}