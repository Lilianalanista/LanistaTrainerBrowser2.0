/*
 * File: app/view/FavoritesPanel.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('LanistaTrainer.view.FavoritesPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.favoritesPanel',

    requires: [
        'Ext.view.View',
        'Ext.XTemplate',
        'Ext.panel.Tool'
    ],

    border: false,
    height: 250,
    id: 'favoritesPanel',
    style: 'padding-top: 120px;',
    width: 400,
    layout: 'fit',
    frameHeader: false,
    header: false,
    headerPosition: 'bottom',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'dataview',
                    cls: 'tpl-gpclg44s',
                    height: 250,
                    id: 'viewCustomersFavorites',
                    tpl: [
                        '<tpl for=".">',
                        '    <div class="customer-item">',
                        '        <div class="lanista-icon lanista-favorites-delete"></div>',
                        '        <div class="customer-list-image customer-info-item" id="customerItemInfo" style="background-image: url({[Ext.ux.ConfigManager.getRoot() + \'/tpmanager/img/p/\' + values[\'id\'] + \'_photo.jpg\']});"></div>',
                        '        <div class="customer-list-background customer-info-item" id="customerItemInfo" style="customer-image">j</div>',
                        '        <div class="customer-list-firstname">{[values[\'first_name\']]}</div>        		',
                        '        <div class="customer-list-lastname">{[values[\'last_name\']]}</div>',
                        '    </div>',
                        '</tpl>  ',
                        ''
                    ],
                    width: 400,
                    itemSelector: 'div.customer-item',
                    store: 'CustomerStore',
                    listeners: {
                        hide: {
                            fn: me.onDataviewHide1,
                            scope: me
                        },
                        afterrender: {
                            fn: me.onViewCustomersAfterRender1,
                            scope: me
                        },
                        itemclick: {
                            fn: me.onViewCustomersItemClick1,
                            scope: me
                        }
                    }
                }
            ],
            tools: [
                {
                    xtype: 'tool',
                    id: 'previousCustomers1',
                    type: 'left'
                },
                {
                    xtype: 'tool',
                    id: 'nextCustomers1',
                    type: 'right'
                }
            ]
        });

        me.callParent(arguments);
    },

    onDataviewHide1: function(component, eOpts) {
        component.destroy();
    },

    onViewCustomersAfterRender1: function(component, eOpts) {

        var el = component.el,
            classValue,
            favoritesToDelete,
            favoritesToDeleteArray = [],
            pos;

        el.on(
            'click', function(e,t) {
                                    if ( t.id === 'customerItemInfo' )
                                            el.addCls('item-not-clicked');
            },
            this, {delegate: '.customer-info-item'});
        el.on(
            'mouseover', function(e,t) {
                                if ( t.id === 'customerItemInfo' )
                                {
                                    el.removeCls('item-not-clicked');
                                    el.addCls('item-clicked');
                                }
                            },
            this,{ delegate: '.customer-info-item'});
        el.on(
            'mouseout', function(e,t) {
                                if ( t.id === 'customerItemInfo' )
                                {
                                    el.removeCls('item-clicked');
                                    el.addCls('item-not-clicked');
                                }
                            },
            this,{delegate: '.customer-info-item'});



        el.on(
            'click', function(e,t) {
                if (!t.parentNode.classList.contains('lanista-list-itemrounded-deleting'))
                    t.parentNode.className = t.parentNode.className + ' lanista-list-itemrounded-deleting';

                favoritesToDelete = LanistaTrainer.app.getController('FavoritesController').favoritesToDelete ? LanistaTrainer.app.getController('FavoritesController').favoritesToDelete : "";
                favoritesToDelete = new String(favoritesToDelete);

                if (favoritesToDelete.valueOf()){
                    if (favoritesToDelete.indexOf(",") > 0)
                        favoritesToDeleteArray = favoritesToDelete.split(",");
                    else
                        favoritesToDeleteArray[0] = favoritesToDelete.valueOf();
                }
                pos = favoritesToDeleteArray.indexOf(component.getRecord(t.parentNode).data.id.toString());
                if (pos >= 0){
                    classValue = t.parentNode.className;
                    classValue = classValue.replace('lanista-list-itemrounded-selected-delete','', 'g');
                    t.parentNode.className = classValue;

                    favoritesToDeleteArray.splice(pos,1);
                    favoritesToDelete = "";
                    if (favoritesToDeleteArray.length > 0){
                        favoritesToDelete = favoritesToDeleteArray[0];
                        for (var i = 1; i < favoritesToDeleteArray.length; i++){
                            favoritesToDelete = favoritesToDelete + ',' + favoritesToDeleteArray[i];
                        }
                    }
                    LanistaTrainer.app.getController('FavoritesController').favoritesToDelete = favoritesToDelete;
                }
                else{
                    t.parentNode.className = t.parentNode.className + ' lanista-list-itemrounded-selected-delete';
                    LanistaTrainer.app.getController('FavoritesController').favoritesToDelete = favoritesToDelete.valueOf() ? favoritesToDelete + ',' + component.getRecord(t.parentNode).data.id : component.getRecord(t.parentNode).data.id;
                    LanistaTrainer.app.getController('FavoritesController').getRightCommandPanel().items.items[1].show();
                   }
           },
            this,{ delegate: '.lanista-favorites-delete'});
        el.on(
            'click', function(e,t) {
                if (!t.parentNode.classList.contains('lanista-list-itemrounded-selected-delete')){
                    classValue = t.parentNode.className;
                    classValue = classValue.replace('lanista-list-itemrounded-deleting','', 'g');
                    t.parentNode.className = classValue;
                }
           },
            this,{ delegate: '.customer-info-item'});

        el.on(
            'mouseover', function(e,t) {
                Ext.get(t).dom.children[0].innerHTML = 'u';
                classValue = Ext.get(t).dom.children[0].className;
                classValue = classValue.replace('lanista-color-delete','', 'g');
                Ext.get(t).dom.children[0].className = classValue + ' lanista-color-no-delete';
              },
            this,{ delegate: '.customer-item'});
        el.on(
            'mouseout', function(e,t) {
                Ext.get(t).dom.children[0].innerHTML = '';
                classValue = Ext.get(t).dom.children[0].className;
                classValue = classValue.replace('lanista-color-no-delete','','g');
                classValue = classValue.replace('lanista-color-no-delete','','g');
                Ext.get(t).dom.children[0].className = classValue;
            },
            this,{ delegate: '.customer-item'});
        el.on(
            'mouseover', function(e,t) {
                classValue = Ext.get(t).dom.className;
                classValue = classValue.replace('item-not-clicked','','g');
                classValue = classValue.replace('lanista-color-no-delete','','g');
                classValue = classValue.replace('lanista-color-no-delete','','g');
                Ext.get(t).dom.className = classValue + ' item-clicked lanista-color-delete';
             },
            this,{ delegate: '.lanista-favorites-delete'});
        el.on(
            'mouseout', function(e,t) {
                classValue = Ext.get(t).dom.className;
                classValue = classValue.replace('item-clicked','','g');
                classValue = classValue.replace('lanista-color-delete','','g');
                Ext.get(t).dom.className = classValue + ' item-not-clicked lanista-color-no-delete';
           },
            this,{ delegate: '.lanista-favorites-delete'});


    },

    onViewCustomersItemClick1: function(dataview, record, item, index, e, eOpts) {
        if ( LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 2] === 'CustomersPanel'){
            setTimeout(function() {
                if (!Ext.get(item).dom.classList.contains('lanista-list-itemrounded-deleting')) {
                    LanistaTrainer.app.fireEvent('close' + LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1], function() {
                        LanistaTrainer.app.currentCustomer = record;
                        LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'CustomerExercisesPanel';
                        LanistaTrainer.app.fireEvent('showCustomerExercisesPanel');
                    });
                }
            },100);
        }

    }

});