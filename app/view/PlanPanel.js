/*
 * File: app/view/PlanPanel.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('LanistaTrainer.view.PlanPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.planPanel',

    requires: [
        'LanistaTrainer.view.PlanExercisesList'
    ],

    cls: 'lanista-plan-panel',
    height: 250,
    id: 'planPanel',
    width: 400,

    layout: {
        type: 'vbox',
        align: 'stretch'
    },

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            listeners: {
                afterrender: {
                    fn: me.onPlanPanelAfterRender,
                    scope: me
                }
            }
        });

        me.processPlanPanel(me);
        me.callParent(arguments);
    },

    processPlanPanel: function(config) {
        config.items = [
            {
                xtype: 'component',
                flex: 1,
                itemId: 'planHeader',
                cls: 'lanista-headerplan-panel',
                maxHeight: 100,
                tpl: [
                    '<div class="plan-header-description" id="planHeaderDescription">{description}</div>',
                    '<div class="plan-header-info">',
                    '    <div class="plan-header-attribute">{[Ext.ux.LanguageManager.TranslationArray.CREATED_AT]}:</div><div class="plan-header-value">{[Ext.Date.format ( values.creation_date, \'d, M Y\' )]}</div>',
                    '    <div class="plan-header-attribute">{[Ext.ux.LanguageManager.TranslationArray.FORM_PLAN_TIME]}:</div><div class="plan-header-value">{duration}</div>',
                    '</div>'
                ]
            },
            {
                xtype: 'tabpanel',
                flex: 1,
                cls: 'lanista-exercices-panel',
                itemId: 'exercicesPanel',
                items: [
                    {
                        xtype: 'planExercisesList',
                        id: 'd1',
                        title: Ext.ux.LanguageManager.TranslationArray.DAY + ' 1'
                    },
                    {
                        xtype: 'container',
                        title: '+',
                        itemId: 'plus'
                    }
                ],
                listeners: {
                        tabchange: {
                            fn: function(tabPanel, newCard, oldCard, eOpts){
                                    var tapPanelSize = tabPanel.items.getCount(),
                                        controller = LanistaTrainer.app.getController ('PlanController');
                                        if (tabPanel.activeTab.title === '+') {
                                            if ( tapPanelSize  < 9 ) {
                                                tabPanel.insert( tapPanelSize -1 , {
                                                    xtype: 'planExercisesList',
                                                    id: 'd'+(tapPanelSize),
                                                    title: Ext.ux.LanguageManager.TranslationArray.DAY + ' ' + (tapPanelSize),
                                                    store: controller.plan.planexercises()
                                                });
                                                tabPanel.setActiveTab(tabPanel.items.items[tapPanelSize -1]);

                                            }
                                        }
                                        else
                                            tabPanel.setActiveTab(newCard);
                            }
                        }
                },
                tabBar: {
                    docked: 'top',
                    html: '<b class="caret" style="-webkit-transform: translate3d(34px, 0px, 0px); "><b class="caret_inner" ></b></b>',
                    itemId: 'mytabbar'
                }
            }
        ];
    },

    onPlanPanelAfterRender: function(component, eOpts) {

        if ( LanistaTrainer.app.getController ('PlanController').plan.data.public_template == 1 ) {
            var panelSize = this.down ('tabpanel').getAt (1).getItems ().getCount();
            this.down ('tabpanel').getAt (1).getAt (panelSize-1).hide();
        }



    }

});