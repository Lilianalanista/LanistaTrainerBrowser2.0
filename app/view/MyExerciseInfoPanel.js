/*
 * File: app/view/MyExerciseInfoPanel.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('LanistaTrainer.view.MyExerciseInfoPanel', {
    extend: 'Ext.form.Panel',
    alias: 'widget.myExerciseInfoPanel',

    requires: [
        'Ext.form.FieldSet',
        'Ext.form.field.ComboBox',
        'Ext.form.field.TextArea',
        'Ext.XTemplate'
    ],

    height: 694,
    id: 'myExerciseInfoPanel',
    width: 400,
    autoScroll: true,
    bodyPadding: 10,
    header: false,
    trackResetOnLoad: true,

    initComponent: function() {
        var me = this;

        me.initialConfig = Ext.apply({
            trackResetOnLoad: true
        }, me.initialConfig);

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'fieldset',
                    cls: 'lanista-myexercise-configuration',
                    id: 'myExercise_configuration',
                    defaultAlign: 'c-c',
                    items: [
                        me.processMyExercise_language({
                            xtype: 'combobox',
                            anchor: '100%',
                            id: 'myExercise_language',
                            name: 'myExercise_language',
                            enableKeyEvents: true,
                            editable: false,
                            listeners: {
                                change: {
                                    fn: me.onMyExercise_languageChange,
                                    scope: me
                                }
                            }
                        }),
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            cls: 'lanista-field-myexercise',
                            id: 'myExercise_name',
                            hideEmptyLabel: false,
                            labelCls: 'lanista-myexercise-item-label',
                            name: 'myExercise_name',
                            listeners: {
                                blur: {
                                    fn: me.onMyExercise_nameBlur,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textareafield',
                            anchor: '100%',
                            cls: 'lanista-field-myexercise',
                            id: 'myExercise_execution',
                            labelCls: 'lanista-myexercise-item-label',
                            name: 'myExercise_execution',
                            listeners: {
                                blur: {
                                    fn: me.onMyExercise_executionBlur,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textareafield',
                            anchor: '100%',
                            cls: 'lanista-field-myexercise lanista-field-myexercise-errors',
                            id: 'myExercise_errors',
                            labelCls: 'lanista-myexercise-item-label',
                            name: 'myExercise_errors',
                            listeners: {
                                blur: {
                                    fn: me.onMyExercise_errorsBlur,
                                    scope: me
                                }
                            }
                        }
                    ]
                },
                {
                    xtype: 'combobox',
                    anchor: '100%',
                    cls: 'lanista-field-myexercise',
                    id: 'myExercise_muscle',
                    labelCls: 'lanista-myexercise-item-label',
                    name: 'muscle',
                    enableKeyEvents: true,
                    editable: false,
                    displayField: 'name',
                    queryMode: 'local',
                    valueField: 'id'
                },
                {
                    xtype: 'combobox',
                    anchor: '100%',
                    cls: 'lanista-field-myexercise',
                    id: 'myExercise_exerciseType',
                    labelCls: 'lanista-myexercise-item-label',
                    name: 'type',
                    enableKeyEvents: true,
                    editable: false,
                    displayField: 'name',
                    queryMode: 'local',
                    valueField: 'id'
                },
                {
                    xtype: 'combobox',
                    anchor: '100%',
                    cls: 'lanista-field-myexercise lanista-field-myexercise-other',
                    id: 'myExercise_other',
                    labelCls: 'lanista-myexercise-item-label',
                    name: 'addition',
                    enableKeyEvents: true,
                    editable: false,
                    displayField: 'name',
                    queryMode: 'local',
                    valueField: 'id'
                },
                {
                    xtype: 'container',
                    cls: 'lanista-myExercise-images',
                    height: 350,
                    id: 'myExercise_images',
                    tpl: [
                        '<div class="lanista-customer-myexercise">',
                        '    <div class="lanista-customer-myexercise-image-title">',
                        '        <div class="lanista-customer-myexercise-image-title-left">{[Ext.ux.LanguageManager.TranslationArray.START_POSITION_MYEXERCISE]}</div>',
                        '        <div class="lanista-customer-myexercise-image-title-right">{[Ext.ux.LanguageManager.TranslationArray.END_POSITION_MYEXERCISE]}</div>',
                        '    </div>',
                        '    <div>',
                        '        <div id="lanista-customer-myexercise-image-2" class="lanista-customer-myexercise-img customer-exercise-img-right" style="background-image: url({[Ext.ux.ConfigManager.getServer() + Ext.ux.ConfigManager.getRoot() + "/tpmanager/img/b/" + values.id]}_1.jpg);"></div>',
                        '        <div id="lanista-customer-myexercise-image-1" class="lanista-customer-myexercise-img customer-exercise-img-left" style="background-image:  url({[Ext.ux.ConfigManager.getServer() + Ext.ux.ConfigManager.getRoot() + "/tpmanager/img/b/" + values.id]}_2.jpg);"></div>',
                        '    </div>',
                        '</div>'
                    ],
                    layout: {
                        type: 'hbox',
                        align: 'stretch',
                        pack: 'end'
                    },
                    listeners: {
                        afterrender: {
                            fn: me.onMyExercise_imagesAfterRender,
                            scope: me
                        }
                    }
                }
            ],
            listeners: {
                afterrender: {
                    fn: me.onMyExerciseInfoPanelAfterRender,
                    scope: me
                }
            }
        });

        me.callParent(arguments);
    },

    processMyExercise_language: function(config) {
        var server =	'http://' + window.location.host,
            root =		Ext.ux.ConfigManager.getRoot() + '/LanistaTrainerBrowser2.0/';

        config.tpl = Ext.create("Ext.XTemplate",
                                '<tpl for="."><div class="x-boundlist-item"><img src=' + server + root + 'resources/images/flags/{image} /> {LanguageName}</div></tpl>');

        config.displayTpl = Ext.create("Ext.XTemplate",
                                       '<tpl for=".">{LanguageName}</tpl>');

        config.valueField = 'IdLanguage';

        return config;

    },

    onMyExercise_languageChange: function(field, newValue, oldValue, eOpts) {
        LanistaTrainer.app.getController ('MyExerciseInfoController').loadData();
    },

    onMyExercise_nameBlur: function(component, e, eOpts) {
        var currentLanguageField = component.up('#myExercise_configuration').down('#myExercise_language').getValue();

        if (currentLanguageField === 'ES')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_ES = component.getValue();
        if (currentLanguageField === 'EN')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_EN = component.getValue();
        if (currentLanguageField === 'DE')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_DE = component.getValue();

    },

    onMyExercise_executionBlur: function(component, e, eOpts) {
        var currentLanguageField = component.up('#myExercise_configuration').down('#myExercise_language').getValue(),
            enter = /\n/gi;

        if (currentLanguageField === 'ES')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_ES = component.getValue().replace(enter, "||");
        if (currentLanguageField === 'EN')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_EN = component.getValue().replace(enter, "||");
        if (currentLanguageField === 'DE')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_DE = component.getValue().replace(enter, "||");

    },

    onMyExercise_errorsBlur: function(component, e, eOpts) {
        var currentLanguageField = component.up('#myExercise_configuration').down('#myExercise_language').getValue(),
            enter = /\n/gi;;

        if (currentLanguageField === 'ES')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_ES = component.getValue().replace(enter, "||");
        if (currentLanguageField === 'EN')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_EN = component.getValue().replace(enter, "||");
        if (currentLanguageField === 'DE')
            LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_DE = component.getValue().replace(enter, "||");

    },

    onMyExercise_imagesAfterRender: function(component, eOpts) {
        var el = component.el,
            server = Ext.ux.ConfigManager.getServer(),
            root = Ext.ux.ConfigManager.getRoot(),
            myExercise = LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).myexercise,
            ini = 4000,
            exerciseId;

        ////////////////////////////////////////////////////////////////////
        // Right Photo
        ////////////////////////////////////////////////////////////////////
        el.on('click',function(e,t) {
            idImage = localStorage.getItem("user_id");
            el.addCls('item-not-clicked');
            var image = Ext.create('Ext.Img', {
                src: server + root + '/tpmanager/img/b/'+ myExercise.data.ext_id + '_1.jpg',
                renderTo: Ext.getBody(),
                hidden: true,
                width: 0,
                height: 0
            });

            if (myExercise.data.ext_id.indexOf ("CUST") == -1) exerciseId = myExercise.data.id; // Lanista Exercise
            else{
                if (LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 2] === 'ExercisesPanel') //Own New Exercise
                    exerciseId = myExercise.data.id;
                else //Own modified Exercise
                    exerciseId = parseInt(myExercise.data.id) - ini;
            }

            var lastPanel = LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1];
            LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'ImagePanel';
            LanistaTrainer.app.fireEvent('showImagePanel', image, lastPanel, server + root + '/tpmanager/exercise/uploadphoto',
                                         {type: 'photo',
                                          customer_id: localStorage.getItem("user_id"),
                                          //exercise_id: myExercise.data.ext_id.indexOf ("CUST") == -1 ? myExercise.data.id : parseInt(myExercise.data.id) - ini,
                                          exercise_id: exerciseId,
                                          order: 1},
                                         function() {});
        },this,{delegate: '.customer-exercise-img-right'});

        el.on(
            'mouseover', function(e,t) {
                el.removeCls('item-not-clicked');
                el.addCls('item-clicked');

            },
            this,{ delegate: '.customer-exercise-img-right'});
        el.on(
            'mouseout', function(e,t) {
                el.removeCls('item-clicked');
                el.addCls('item-not-clicked');
            },
            this,{delegate: '.customer-exercise-img-right'});


        ////////////////////////////////////////////////////////////////////
        // Left Photo
        ////////////////////////////////////////////////////////////////////
        el.on('click',function(e,t) {
            idImage = localStorage.getItem("user_id");
            el.addCls('item-not-clicked');
            var image = Ext.create('Ext.Img', {
                src: server + root + '/tpmanager/img/b/'+ myExercise.data.ext_id + '_2.jpg',
                renderTo: Ext.getBody(),
                hidden: true,
                width: 0,
                height: 0
            });

            if (myExercise.data.ext_id.indexOf ("CUST") == -1) exerciseId = myExercise.data.id; // Lanista Exercise
            else{
                if (LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 2] === 'ExercisesPanel') //Own New Exercise
                    exerciseId = myExercise.data.id;
                else //Own modified Exercise
                    exerciseId = parseInt(myExercise.data.id) - ini;
            }

            var lastPanel = LanistaTrainer.app.panels[LanistaTrainer.app.panels.length - 1];
            LanistaTrainer.app.panels[LanistaTrainer.app.panels.length] = 'ImagePanel';
            LanistaTrainer.app.fireEvent('showImagePanel', image, lastPanel, server + root + '/tpmanager/exercise/uploadphoto',
                                         {type: 'photo',
                                          customer_id: localStorage.getItem("user_id"),
                                          //exercise_id: myExercise.data.ext_id.indexOf ("CUST") == -1 ? myExercise.data.id : parseInt(myExercise.data.id) - ini,
                                          exercise_id: exerciseId,
                                          order: 2},
                                         function() {});
        },this,{delegate: '.customer-exercise-img-left'});

        el.on(
            'mouseover', function(e,t) {
                el.removeCls('item-not-clicked');
                el.addCls('item-clicked');
             },
            this,{ delegate: '.customer-exercise-img-left'});
        el.on(
            'mouseout', function(e,t) {
                el.removeCls('item-clicked');
                el.addCls('item-not-clicked');
            },
            this,{delegate: '.customer-exercise-img-left'});
    },

    onMyExerciseInfoPanelAfterRender: function(component, eOpts) {
        var languagesStore = Ext.create('Ext.data.Store', {
                                fields: ['image', 'LanguageName', 'IdLanguage'],
                                data : [
                                    {"image": "es.png", "LanguageName":"Español", "IdLanguage":"ES"},
                                    {"image": "de.png", "LanguageName":"Deutsch", "IdLanguage":"DE"},
                                    {"image": "gb.png", "LanguageName":"English", "IdLanguage":"EN"}
                                ]
                            }),
            fields = component.getForm().getFields(),
            record,
            musclesStore,
            typesStore,
            othersStore,
            myExercise = LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).myexercise;

        fields.getByKey('myExercise_language').bindStore(languagesStore);
        languagesStore.load();

        fields.getByKey('myExercise_language').setValue(Ext.ux.LanguageManager.lang);
        fields.getByKey('myExercise_muscle').setFieldLabel(Ext.ux.LanguageManager.TranslationArray.FILTER_MUSCLES);
        fields.getByKey('myExercise_exerciseType').setFieldLabel(Ext.ux.LanguageManager.TranslationArray.FILTER_TYPE);
        fields.getByKey('myExercise_other').setFieldLabel(Ext.ux.LanguageManager.TranslationArray.FILTER_ADDITIVES);

        record = [{id: myExercise.data.ext_id}];
        component.getComponent('myExercise_images').update(record[0]);

        //Muscles Store
        musclesStore = Ext.create('Ext.data.Store', {
            fields: ['id', 'name'],
            data : [
                {"id":0, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_ALL_MUSCLES.toUpperCase()},
                {"id":3, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_SHOULDER.toUpperCase()},
                {"id":8, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BICEPS.toUpperCase()},
                {"id":9, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_TRICEPS.toUpperCase()},
                {"id":10, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_FOREARM.toUpperCase()},
                {"id":1, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_CHEST.toUpperCase()},
                {"id":2, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_UPPERBACK.toUpperCase()},
                {"id":5, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_LOWERBACK.toUpperCase()},
                {"id":7, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_AB.toUpperCase()},
                {"id":6, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_WAISHIP.toUpperCase()},
                {"id":4, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_FRONTTHIG.toUpperCase()},
                {"id":14, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BACKTHIGH.toUpperCase()},
                {"id":11, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_LOWERLEG.toUpperCase()}
            ]
        });
        fields.getByKey('myExercise_muscle').bindStore(musclesStore);
        musclesStore.load();

        //Exercises Types Store
        typesStore = Ext.create('Ext.data.Store', {
            fields: ['id', 'name'],
            data : [
                {"id":0, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_ALL_EXERCISES.toUpperCase()},
                {"id":4, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BODYWEIGHT.toUpperCase()},
                {"id":1, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_MACHINE.toUpperCase()},
                {"id":2, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_FREEWEIGHTS.toUpperCase()},
                {"id":3, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_CABLE.toUpperCase()},
                {"id":5, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_STRETCH.toUpperCase()},
                {"id":7, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_CARDIO.toUpperCase()},
                {"id":8, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_SPEC.toUpperCase()},
                {"id":9, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_UNILATERAL.toUpperCase()}
            ]
        });
        fields.getByKey('myExercise_exerciseType').bindStore(typesStore);
        typesStore.load();

        //Others Store
        othersStore = Ext.create('Ext.data.Store', {
            fields: ['id', 'name'],
            data : [
                {"id":0, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_ALL_MACHINES.toUpperCase()},
                {"id":1, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_DUMBBELLS.toUpperCase()},
                {"id":3, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BARBELL.toUpperCase()},
                {"id":2, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_KETT.toUpperCase()},
                {"id":4, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BANK.toUpperCase()},
                {"id":5, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_VARADD.toUpperCase()},
                {"id":6, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BALL.toUpperCase()},
                {"id":7, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_BLAST.toUpperCase()},
                {"id":8, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_JUMPER.toUpperCase()},
                {"id":9, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_FOAM.toUpperCase()},
                {"id":11, "name":Ext.ux.LanguageManager.TranslationArray.FILTER_MINIBAND.toUpperCase()}
            ]
        });
        fields.getByKey('myExercise_other').bindStore(othersStore);
        othersStore.load();

        if (myExercise)
        {
            component.getForm().setValues(
                {
                    myExercise_name:		Ext.ux.LanguageManager.lang === 'ES' ? myExercise.data.name_ES :
                                            Ext.ux.LanguageManager.lang === 'EN' ? myExercise.data.name_EN :
                                            myExercise.data.name_DE,
                    myExercise_execution:	Ext.ux.LanguageManager.lang === 'ES' ? myExercise.data.coatchingnotes_ES.split( "||" ).join( "\n" ) :
                                            Ext.ux.LanguageManager.lang === 'EN' ? myExercise.data.coatchingnotes_EN.split( "||" ).join( "\n" ) :
                                            myExercise.data.coatchingnotes_DE.split( "||" ).join( "\n" ),
                    myExercise_errors:		Ext.ux.LanguageManager.lang === 'ES' ? myExercise.data.mistakes_ES.split( "||" ).join( "\n" ) :
                                            Ext.ux.LanguageManager.lang === 'EN' ? myExercise.data.mistakes_EN.split( "||" ).join( "\n" ) :
                                            myExercise.data.mistakes_DE.split( "||" ).join( "\n" ),
                    muscle:					myExercise.data.muscle,
                    addition:				myExercise.data.addition,
                    type:					myExercise.data.type,
                    id:						myExercise.data.id
                }
            );


            //if (Ext.ux.LanguageManager.lang === 'ES'){
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_ES = myExercise.data.name_ES;
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_ES = myExercise.data.coatchingnotes_ES.split( "||" ).join( "\n" );
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_ES = myExercise.data.mistakes_ES.split( "||" ).join( "\n" );
            //}
            //if (Ext.ux.LanguageManager.lang === 'EN'){
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_EN = myExercise.data.name_EN;
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_EN = myExercise.data.coatchingnotes_EN.split( "||" ).join( "\n" );
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_EN = myExercise.data.mistakes_EN.split( "||" ).join( "\n" );
            //}
            //if (Ext.ux.LanguageManager.lang === 'DE'){
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).name_DE = myExercise.data.name_DE;
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).execution_DE = myExercise.data.coatchingnotes_DE.split( "||" ).join( "\n" );
                LanistaTrainer.app.getController ( 'MyExerciseInfoController' ).errors_DE = myExercise.data.mistakes_DE.split( "||" ).join( "\n" );
            //}

        }

        fields.each(function(field)
                    {field.on('change',function(f,n,o)
                              {
                                  //f: field;  n: new value;  o: old value
                                  LanistaTrainer.app.fireEvent('showSavePanel', 'saveSettingsButton', 'cancelSettingsButton');
                              }
                             );
                     field.on('keypress',function(f,e,opts)
                              {
                                  //f: field;  e: key pressed;  o: options
                                  if(e.getKey() == e.ENTER){
                                      if ( !Ext.getCmp('rightCommandPanel').down('#saveSettingsButton').hidden )
                                          Ext.getCmp('rightCommandPanel').down('#saveSettingsButton').fireEvent('click', function() {
                                              f.focus();
                                          });
                                  }
                              }
                             );
                    }
                   );



    }

});